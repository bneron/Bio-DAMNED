---
- name: Creating bwa directory for "{{ bank_name }}" genome
  become: yes
  become_user: "{{ bank_user }}"
  file: path={{ bank_root }}/{{ bank_name }}/bwa
        state=directory
        owner={{ bank_user }}
        group={{ bank_group }}
        mode=0775

- name: Cleaning "{{ bank_name }}" bwa indexes links
  become: yes
  become_user: "{{ bank_user }}"
  file: path={{bank_root}}/index/bwa/{{ bank_name | basename }} state=absent
  with_fileglob:
    - "{{ bank_root }}/{{ bank_name }}/bwa/*"

- name: Cleaning "{{ bank_name }}" old bwa indexes
  become: yes
  become_user: "{{ bank_user }}"
  file: >
    path={{ item }}
    state=absent
  with_fileglob:
    - "{{ bank_root }}/{{ bank_name }}/bwa/*"

- name: Indexing "{{ bank_name }}" for bwa
  become: yes
  become_user: "{{ bank_user }}"
  shell: >
     bowtie2-build {{ bank_root }}/{{ bank_name }}/fasta/{{ bank_name }}.fa {{ bank_root }}/{{ bank_name }}/bwa/
 (data.dir)s/%(db.name)s/future_release/uncompressed/hg19.fa %(data.dir)s/%(db.name)s/future_release/bwa bwtsw
  bwa index -a bwtsw -p {{ bank_root }}/{{ bank_name }}/bwa/ {{ bank_root }}/{{ bank_name }}/fasta/{{ bank_name }}.fa

- name: Creating links for "{{ bank_name }}" bwa indexes
  become: yes
  become_user: "{{ bank_user }}"
  file: >
    src={{ item }}
    dest={{ bank_root }}/index/bwa/{{ item | basename }}
    state=link
  with_fileglob:
    - "{{ bank_root }}/{{ bank_name }}/bwa/*"